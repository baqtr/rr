import os
import telebot
import requests
import threading
import time
from datetime import datetime, timedelta
import pytz
import zipfile
import shutil

# Ø§Ø³ØªÙŠØ±Ø§Ø¯ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©
bot_token = "7031770762:AAEKh2HzaEn-mUm6YkqGm6qZA2JRJGOUQ20"
github_token = "YOUR_GITHUB_TOKEN_HERE"

# Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¨ÙˆØª
bot = telebot.TeleBot(bot_token)

# Ø§Ù„Ù‡ÙŠØ±ÙˆÙƒÙˆ API
HEROKU_BASE_URL = 'https://api.heroku.com'

# Ø¬ÙŠØªÙ‡Ø§Ø¨ API
GITHUB_BASE_URL = 'https://api.github.com'

# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù„Ø­Ø°Ù Ø§Ù„Ø°Ø§ØªÙŠ
self_deleting_apps = {}

# ØªØ®Ø²ÙŠÙ† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
user_accounts = {}

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØªØ®ØµÙŠØµÙ‡Ø§
def create_main_buttons():
    markup = telebot.types.InlineKeyboardMarkup()
    button1 = telebot.types.InlineKeyboardButton("Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ â•", callback_data="add_account")
    button2 = telebot.types.InlineKeyboardButton("Ø­Ø³Ø§Ø¨Ø§ØªÙƒ ğŸ—‚ï¸", callback_data="list_accounts")
    button3 = telebot.types.InlineKeyboardButton("Ù‚Ø³Ù… Ø¬ÙŠØªÙ‡Ø§Ø¨ ğŸŒ", callback_data="github_section")
    markup.add(button1, button2)
    markup.add(button3)
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©
def create_back_button():
    markup = telebot.types.InlineKeyboardMarkup()
    back_button = telebot.types.InlineKeyboardButton("Ø§Ù„Ø¹ÙˆØ¯Ø© â†©ï¸", callback_data="go_back")
    markup.add(back_button)
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
def create_account_control_buttons(account_index):
    markup = telebot.types.InlineKeyboardMarkup()
    button1 = telebot.types.InlineKeyboardButton("Ø¬Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‡ÙŠØ±ÙˆÙƒÙˆ ğŸ“¦", callback_data=f"list_heroku_apps_{account_index}")
    button2 = telebot.types.InlineKeyboardButton("Ø­Ø°Ù ØªØ·Ø¨ÙŠÙ‚ âŒ", callback_data=f"delete_app_{account_index}")
    button3 = telebot.types.InlineKeyboardButton("Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø°Ø§ØªÙŠ â²ï¸", callback_data=f"self_delete_app_{account_index}")
    button4 = telebot.types.InlineKeyboardButton("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ â³", callback_data="remaining_time")
    markup.add(button1) 
    markup.add(button2)
    markup.add(button3)
    markup.add(button4)
    markup.add(telebot.types.InlineKeyboardButton("Ø§Ù„Ø¹ÙˆØ¯Ø© â†©ï¸", callback_data="list_accounts"))
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø±ÙŠ Ø§Ù„Ø­Ø°Ù Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
def create_delete_repo_buttons():
    markup = telebot.types.InlineKeyboardMarkup()
    button1 = telebot.types.InlineKeyboardButton("Ø­Ø°Ù Ø§Ù„ÙƒÙ„ ğŸ—‘ï¸", callback_data="delete_all_repos")
    button2 = telebot.types.InlineKeyboardButton("Ø­Ø°Ù Ù…Ø³ØªÙˆØ¯Ø¹ ğŸ“", callback_data="delete_repo")
    markup.add(button1)
    markup.add(button2)
    markup.add(telebot.types.InlineKeyboardButton("Ø§Ù„Ø¹ÙˆØ¯Ø© â†©ï¸", callback_data="list_accounts"))
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø§Ù„Ø±ÙØ¹
def create_upload_button():
    markup = telebot.types.InlineKeyboardMarkup()
    button = telebot.types.InlineKeyboardButton("Ø±ÙØ¹ Ù…Ù„Ù ğŸ“¤", callback_data="upload_file")
    markup.add(button)
    markup.add(telebot.types.InlineKeyboardButton("Ø§Ù„Ø¹ÙˆØ¯Ø© â†©ï¸", callback_data="list_accounts"))
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
@bot.message_handler(commands=['start'])
def send_welcome(message):
    user_id = message.from_user.id
    if user_id not in user_accounts:
        user_accounts[user_id] = []
    bot.send_message(message.chat.id, "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª.", reply_markup=create_main_buttons())

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
def add_account(call):
    # Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
def add_account(call):
    msg = bot.edit_message_text("ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø³Ø§Ø¨ Heroku:", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
    bot.register_next_step_handler(msg, handle_new_account)  # Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§ ÙÙŠ Ø§Ù„Ø³Ø·Ø± 90
    api_key = message.text.strip()
    user_id = message.from_user.id
    if api_key in [account['api_key'] for account in user_accounts[user_id]]:
        bot.send_message(message.chat.id, "Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¶Ø§Ù Ù…Ø³Ø¨Ù‚Ù‹Ø§.", reply_markup=create_main_buttons())
    elif validate_heroku_api_key(api_key):
        user_accounts[user_id].append({'api_key': api_key})
        bot.send_message(message.chat.id, "ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Heroku Ø¨Ù†Ø¬Ø§Ø­!", reply_markup=create_main_buttons())
    else:
        bot.send_message(message.chat.id, "Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", reply_markup=create_main_buttons())

# Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù…ÙØªØ§Ø­ API Ù„Ù‡ÙŠØ±ÙˆÙƒÙˆ
def validate_heroku_api_key(api_key):
    headers = {
        'Authorization': f'Bearer {api_key}',
        'Accept': 'application/vnd.heroku+json; version=3'
    }
    response = requests.get(f'{HEROKU_BASE_URL}/apps', headers=headers)
    return response.status_code == 200

# Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø­Ø³Ø§Ø¨ Ù‡ÙŠØ±ÙˆÙƒÙˆ
def get_heroku_account_name(api_key):
    headers = {
        'Authorization': f'Bearer {api_key}',
        'Accept': 'application/vnd.heroku+json; version=3'
    }
    response = requests.get(f'{HEROKU_BASE_URL}/account', headers=headers)
    if response.status_code == 200:
        return response.json().get('email', 'Unknown')
    return 'Unknown'

# Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‡ÙŠØ±ÙˆÙƒÙˆ
def list_heroku_apps(call):
    account_index = int(call.data.split("_")[-1])
    user_id = call.from_user.id
    if not user_accounts[user_id]:
        bot.edit_message_text("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¶Ø§ÙØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        return

    headers = {
        'Authorization': f'Bearer {user_accounts[user_id][account_index]["api_key"]}',
        'Accept': 'application/vnd.heroku+json; version=3'
    }
    bot.edit_message_text("Ø¬Ù„Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª... â¬›â¬œ 0%", chat_id=call.message.chat.id, message_id=call.message.message_id)
    time.sleep(2)
    response = requests.get(f'{HEROKU_BASE_URL}/apps', headers=headers)
    if response.status_code == 200:
        apps = response.json()
        apps_list = "\n".join([f"`{app['name']}`" for app in apps])
        bot.edit_message_text("Ø¬Ù„Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª... â¬›â¬› 50%", chat_id=call.message.chat.id, message_id=call.message.message_id)
        time.sleep(2)
        bot.edit_message_text(f"Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡ÙŠØ±ÙˆÙƒÙˆ:\n{apps_list}", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button(), parse_mode='Markdown')
    else:
        bot.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ù† Ù‡ÙŠØ±ÙˆÙƒÙˆ.", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())

# Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ù‡ÙŠØ±ÙˆÙƒÙˆ
def delete_heroku_app(app_name, message, account_index):
    user_id = message.from_user.id
    headers = {
        'Authorization': f'Bearer {user_accounts[user_id][account_index]["api_key"]}',
        'Accept': 'application/vnd.heroku+json; version=3'
    }
    response = requests.delete(f'{HEROKU_BASE_URL}/apps/{app_name}', headers=headers)
    if response.status_code == 202:
        bot.send_message(message.chat.id, f"ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ `{app_name}` Ø¨Ù†Ø¬Ø§Ø­.", parse_mode='Markdown')
    else:
        bot.send_message(message.chat.id, "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.")

# Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø­Ø°Ù Ø§Ù„Ø°Ø§ØªÙŠ
def show_remaining_time(call):
    remaining_time_message = "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù„Ø­Ø°Ù Ø§Ù„Ø°Ø§ØªÙŠ:\n"
    for app_name, data in list(self_deleting_apps.items()):
        if app_name in self_deleting_apps:
            elapsed_time = (datetime.now(pytz.timezone('Asia/Baghdad')) - data['start_time']).total_seconds() // 60
            remaining_minutes = max(data['minutes'] - elapsed_time, 0)
            remaining_time_message += f"- {app_name}:\n  Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {format_remaining_time(remaining_minutes)}\n  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø°Ù: {calculate_deletion_time(remaining_minutes)}\n"
        else:
            remaining_time_message += f"- {app_name}: ØªÙ… Ø­Ø°ÙÙ‡."
    bot.edit_message_text(remaining_time_message, chat_id=call.message.chat.id, message_id=call.message.message_id, parse_mode='Markdown', reply_markup=create_back_button())

# Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
def format_remaining_time(minutes):
    delta = timedelta(minutes=minutes)
    hours, remainder = divmod(delta.seconds, 3600)
    minutes = remainder // 60
    return f"{hours} Ø³Ø§Ø¹Ø© Ùˆ{minutes} Ø¯Ù‚ÙŠÙ‚Ø©"

# Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø­Ø°Ù
def calculate_deletion_time(minutes):
    iraq_timezone = pytz.timezone('Asia/Baghdad')
    now = datetime.now(iraq_timezone)
    deletion_time = now + timedelta(minutes=minutes)
    return deletion_time.strftime("%I:%M %p - %Y-%m-%d")

# Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¨ÙˆØª
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if call.data == "add_account":
        add_account(call)
    elif call.data == "list_accounts":
        list_accounts(call)
    elif call.data == "github_section":
        bot.send_message(call.message.chat.id, "Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ†ÙÙŠØ°Ù‡:", reply_markup=create_github_buttons())
    elif call.data.startswith("list_heroku_apps_"):
        list_herokudef callback_query(call):
    if call.data == "add_account":
        add_account(call)
    elif call.data == "list_accounts":
        list_accounts(call)
    elif call.data == "github_section":
        bot.send_message(call.message.chat.id, "Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ†ÙÙŠØ°Ù‡:", reply_markup=create_github_buttons())
    elif call.data.startswith("list_heroku_apps_"):
        list_heroku_apps(call)
    elif call.data.startswith("delete_app_"):
        account_index = int(call.data.split("_")[-1])
        msg = bot.edit_message_text("ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø­Ø°ÙÙ‡:", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        bot.register_next_step_handler(msg, lambda m: handle_app_name_for_deletion(m, account_index))
    elif call.data.startswith("self_delete_app_"):
        account_index = int(call.data.split("_")[-1])
        msg = bot.edit_message_text("ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø­Ø°Ù Ø§Ù„Ø°Ø§ØªÙŠ:", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        bot.register_next_step_handler(msg, lambda m: handle_app_name_for_self_deletion(m, account_index))
    elif call.data == "remaining_time":
        show_remaining_time(call)
    elif call.data == "delete_all_repos":
        delete_all_repos(call)
    elif call.data == "delete_repo":
        msg = bot.edit_message_text("ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù„Ø­Ø°ÙÙ‡:", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        bot.register_next_step_handler(msg, handle_repo_deletion)
    elif call.data == "upload_file":
        msg = bot.edit_message_text("ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· (ZIP) Ù„Ø±ÙØ¹Ù‡:", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        bot.register_next_step_handler(msg, handle_zip_file)

# Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø¬ÙŠØªÙ‡Ø§Ø¨
def create_github_buttons():
    markup = telebot.types.InlineKeyboardMarkup()
    button1 = telebot.types.InlineKeyboardButton("Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª ğŸ—‘ï¸", callback_data="delete_all_repos")
    button2 = telebot.types.InlineKeyboardButton("Ø­Ø°Ù Ù…Ø³ØªÙˆØ¯Ø¹ ğŸ“", callback_data="delete_repo")
    button3 = telebot.types.InlineKeyboardButton("Ø±ÙØ¹ Ù…Ù„Ù ğŸ“¤", callback_data="upload_file")
    markup.add(button1)
    markup.add(button2)
    markup.add(button3)
    markup.add(telebot.types.InlineKeyboardButton("Ø§Ù„Ø¹ÙˆØ¯Ø© â†©ï¸", callback_data="list_accounts"))
    return markup

# Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
def delete_all_repos(call):
    user_id = call.from_user.id
    if not user_id in user_accounts or not user_accounts[user_id]:
        bot.edit_message_text("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¶Ø§ÙØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())
        return
    for account in user_accounts[user_id]:
        github_headers = {'Authorization': f'token {github_token}'}
        response = requests.get(f'{GITHUB_BASE_URL}/user/repos', headers=github_headers)
        if response.status_code == 200:
            repos = response.json()
            for repo in repos:
                response = requests.delete(f'{GITHUB_BASE_URL}/repos/{repo["full_name"]}', headers=github_headers)
                if response.status_code == 204:
                    bot.send_message(call.message.chat.id, f"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo['full_name']} Ø¨Ù†Ø¬Ø§Ø­.")
                else:
                    bot.send_message(call.message.chat.id, f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo['full_name']}.")
        else:
            bot.edit_message_text("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ù…Ù† Ø¬ÙŠØªÙ‡Ø§Ø¨.", chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=create_back_button())

# Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ù…Ø³ØªÙˆØ¯Ø¹ Ù…Ø­Ø¯Ø¯
def handle_repo_deletion(message):
    repo_name = message.text.strip()
    user_id = message.from_user.id
    if user_id in user_accounts and user_accounts[user_id]:
        github_headers = {'Authorization': f'token {github_token}'}
        response = requests.get(f'{GITHUB_BASE_URL}/user/repos', headers=github_headers)
        if response.status_code == 200:
            repos = response.json()
            for repo in repos:
                if repo["full_name"] == repo_name:
                    response = requests.delete(f'{GITHUB_BASE_URL}/repos/{repo["full_name"]}', headers=github_headers)
                    if response.status_code == 204:
                        bot.send_message(message.chat.id, f"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name} Ø¨Ù†Ø¬Ø§Ø­.")
                        return
            bot.send_message(message.chat.id, f"Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.")
        else:
            bot.send_message(message.chat.id, "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ù…Ù† Ø¬ÙŠØªÙ‡Ø§Ø¨.")
    else:
        bot.sendelse:
        bot.send_message(message.chat.id, "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¶Ø§ÙØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", reply_markup=create_back_button())

# Ø¯Ø§Ù„Ø© Ù„Ø±ÙØ¹ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ· Ø¥Ù„Ù‰ Ø¬ÙŠØªÙ‡Ø§Ø¨
def handle_zip_file(message):
    user_id = message.from_user.id
    if user_id in user_accounts and user_accounts[user_id]:
        # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±Ø³Ù„
        if message.content_type != 'document':
            bot.send_message(message.chat.id, "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ· (ZIP).", reply_markup=create_back_button())
            return

        # Ø­Ù…Ù„ Ø§Ù„Ù…Ù„Ù ÙˆÙÙƒ Ø§Ù„Ø¶ØºØ·
        file_info = bot.get_file(message.document.file_id)
        file = requests.get(f'https://api.telegram.org/file/bot{bot_token}/{file_info.file_path}')
        with open('file.zip', 'wb') as f:
            f.write(file.content)
        import zipfile
        with zipfile.ZipFile('file.zip', 'r') as zip_ref:
            zip_ref.extractall('extracted_files')

        # Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø¥Ù„Ù‰ Ø¬ÙŠØªÙ‡Ø§Ø¨
        for account in user_accounts[user_id]:
            github_headers = {'Authorization': f'token {github_token}'}
            repo_name = f"repo_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
            response = requests.post(f'{GITHUB_BASE_URL}/user/repos', headers=github_headers, json={'name': repo_name})
            if response.status_code == 201:
                bot.send_message(message.chat.id, f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name} Ø¨Ù†Ø¬Ø§Ø­.")
                # Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© ÙˆØ£Ø¶ÙÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                files = os.listdir('extracted_files')
                for file_name in files:
                    with open(f'extracted_files/{file_name}', 'rb') as file_content:
                        response = requests.post(f'{GITHUB_BASE_URL}/repos/{account["username"]}/{repo_name}/contents/{file_name}', headers=github_headers, json={'message': 'Add file', 'content': base64.b64encode(file_content.read()).decode()})
                        if response.status_code == 201:
                            bot.send_message(message.chat.id, f"ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù {file_name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name} Ø¨Ù†Ø¬Ø§Ø­.")
                        else:
                            bot.send_message(message.chat.id, f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù {file_name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name}.")
            else:
                bot.send_message(message.chat.id, f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {repo_name}.")
        # Ù‚Ù… Ø¨Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        os.remove('file.zip')
        shutil.rmtree('extracted_files')
    else:
        bot.send_message(message.chat.id, "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¶Ø§ÙØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", reply_markup=create_back_button())

# Ø§Ù„ØªØ´ØºÙŠÙ„
if __name__ == "__main__":
    bot.polling()
